<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QA í…ŒìŠ¤íŠ¸ ìë™í™” ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" href="/static/dashboard.css" />
  <script defer src="/static/dashboard.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="title">
        <span class="logo">ğŸ¯</span>
        <span>QA í…ŒìŠ¤íŠ¸ ìë™í™” ëŒ€ì‹œë³´ë“œ</span>
      </div>
      <div class="actions">
        <button class="btn ghost" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
        <form action="/run" method="post">
          <button class="btn primary" type="submit">ì „ì²´ ì‹¤í–‰</button>
        </form>
        <form action="/sync_github" method="post">
          <button class="btn ghost" type="submit">GitHub ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </form>

        {% if actions_url %}
          <a class="btn dark" href="{{ actions_url }}" target="_blank" rel="noreferrer">GitHub Actions</a>
        {% else %}
          <button class="btn dark" disabled title="GITHUB_ACTIONS_URL envê°€ í•„ìš”í•©ë‹ˆë‹¤">GitHub Actions</button>
        {% endif %}
      </div>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash">
          {% for category, msg in messages %}
            <pre class="flashbox {{ category }}">{{ msg }}</pre>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <section class="cards">
      <div class="card">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-label">ì „ì²´ í…ŒìŠ¤íŠ¸</div>
        <div class="card-value">{{ cards.total }}</div>
      </div>
      <div class="card">
        <div class="card-icon">âœ…</div>
        <div class="card-label">ì„±ê³µ</div>
        <div class="card-value">{{ cards.pass }}</div>
      </div>
      <div class="card">
        <div class="card-icon">âŒ</div>
        <div class="card-label">ì‹¤íŒ¨</div>
        <div class="card-value">{{ cards.fail }}</div>
      </div>
      <div class="card">
        <div class="card-icon">ğŸ†•</div>
        <div class="card-label">ì‹ ê·œ</div>
        <div class="card-value">{{ cards.new }}</div>
      </div>
      <div class="card">
        <div class="card-icon">ğŸ“ˆ</div>
        <div class="card-label">ì„±ê³µë¥ </div>
        <div class="card-value">{{ cards.rate }}%</div>
      </div>
    </section>

    <section class="tabs">
      <button class="tab active" data-tab="cases">ğŸ§¾ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</button>
      <button class="tab" data-tab="runs">ğŸ§¾ ì‹¤í–‰ íˆìŠ¤í† ë¦¬</button>
      <button class="tab" data-tab="actions">ğŸš€ GitHub Actions</button>
    </section>

    <main class="panel">
      <!-- ì¼€ì´ìŠ¤ íƒ­ -->
      <div class="tabpane active" id="tab-cases">
        <div class="toolbar">
          <input id="caseSearch" class="search" placeholder="ê²€ìƒ‰..." />
          <select id="caseFilter" class="select">
            <option value="all">ì „ì²´</option>
            <option value="new">NEW</option>
          </select>
        </div>

        <div id="caseList" class="list">
          {% for c in cases %}
            <div class="item" data-id="{{ c.id }}" data-name="{{ c.name }}">
              <div class="tag">#{{ c.id }}</div>
              <div class="name">{{ c.name }}</div>
              <div class="badge">NEW</div>
            </div>
          {% endfor %}
          {% if cases|length == 0 %}
            <div class="empty">ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. SHEET_ID/SHEET_RANGE í™˜ê²½ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
          {% endif %}
        </div>
      </div>

      <!-- ì‹¤í–‰ íˆìŠ¤í† ë¦¬ íƒ­ -->
      <div class="tabpane" id="tab-runs">
        <div class="subhead">
          {% if latest_run %}
            <div>ìµœê·¼ ì‹¤í–‰: {{ latest_run.executed_at }}</div>
          {% else %}
            <div>ìµœê·¼ ì‹¤í–‰: ì—†ìŒ</div>
          {% endif %}
        </div>

        <div class="list">
          {% for run in runs %}
            <div class="run">
              <div class="run-head">
                <div class="run-time">{{ run.executed_at }}</div>
                <div class="run-sum">
                  PASS {{ run.summary.pass }} /
                  FAIL {{ run.summary.fail }} /
                  ERROR {{ run.summary.error }}
                </div>
              </div>

              <div class="run-results">
                {% for r in run.results %}
                  <div class="r {{ r.status }}">
                    <span class="rid">{{ r.id }}</span>
                    <span class="rname">{{ r.name }}</span>
                    <span class="rengine">{{ r.engine }}</span>
                    <span class="rstatus">{{ r.status }}</span>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
          {% if runs|length == 0 %}
            <div class="empty">ì•„ì§ ì‹¤í–‰ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤. â€œì „ì²´ ì‹¤í–‰â€ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</div>
          {% endif %}
        </div>
      </div>

      <!-- Actions íƒ­ -->
      <div class="tabpane" id="tab-actions">
        {% if actions_url %}
          <div class="actions-box">
            <div class="empty">GitHub Actionsë¡œ ì´ë™í•´ ì‹¤í–‰/ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
            <a class="btn dark" href="{{ actions_url }}" target="_blank" rel="noreferrer">GitHub Actions ì—´ê¸°</a>
          </div>
        {% else %}
          <div class="empty">
            GITHUB_ACTIONS_URL í™˜ê²½ë³€ìˆ˜ê°€ ì—†ì–´ì„œ ë§í¬ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br/>
            ì˜ˆ: export GITHUB_ACTIONS_URL="https://github.com/USER/REPO/actions"
          </div>
        {% endif %}
      </div>
    </main>
  </div>
</body>
</html>
